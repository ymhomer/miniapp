<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Content-Security-Policy" content="frame-ancestors 'self';">
    <meta http-equiv="X-Frame-Options" content="allow">
    <title>Guess Number Game</title>
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.6.0/css/bootstrap.min.css">
	<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://cdn.bootcdn.net/ajax/libs/popper.js/1.16.1/umd/popper.min.js"></script>
	<script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.6.0/js/bootstrap.min.js"></script>

</head>
<body class="container-fluid">
    <div id="navbar"></div>
    <div class="row mt-5">
        <div class="col-md-6">
            <h1 class="mb-3">Guess Number Game</h1>
        </div>
        <div class="col-md-6 text-right">
            <button type="button" class="btn btn-info" data-toggle="modal" data-target="#instructionsModal">
                How to Play
            </button>
        </div>
    </div>
    <p>Input four non-repeating numbers and press the "Enter" key or click the "Guess" button</p>
    <div class="input-group mb-3">
        <input type="text" class="form-control" id="input">
        <div class="input-group-append">
            <button type="button" class="btn btn-primary" id="guess-btn" onclick="guess()">Guess</button>
        </div>
    </div>
    <br>
    <div id="guess-count"></div>
    <table class="table table-bordered">
        <thead class="thead-dark">
            <tr>
                <th scope="col">Guess</th>
                <th scope="col">Result</th>
            </tr>
        </thead>
        <tbody id="history"></tbody>
    </table>
    <br>
    <button type="button" class="btn btn-success" id="new-game" onclick="newGame()">New Game</button>

<!-- Modal -->
<div class="modal fade" id="instructionsModal" tabindex="-1" role="dialog" aria-labelledby="instructionsModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content"> <div class="modal-header">
			<h5 class="modal-title" id="instructionsModalLabel">How to Play</h5>
			<button type="button" class="close" data-dismiss="modal" aria-label="Close">
				<span aria-hidden="true">&times;</span> </button> </div> <div class="modal-body">
			<p>To play the game, you need to guess a 4-digit number, where each digit is different.</p>
			<p>After each guess you will get feedback on how many digits are : </p>
			<p>    (A) correct and in the right position </p>
			<p>    (B) correct but in the wrong position </p>
			<p>Keep guessing until you correctly guess the number!</p> </div> <div class="modal-footer">
			<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
		</div>
	</div>
</div>
</div>
<script>
// Design for master page -- but not working now
$(function() {
	document.getElementById('new-game').style.display = 'none';
	$("#navbar").load("navbar.html");
});

// Generate a random target number
let target = '';
while (target.length < 4) {
	let num = Math.floor(Math.random() * 10);
	if (!target.includes(num.toString())) {
		target += num.toString();
	}
}

// Save all the guess records
let guessHistory = [];
    function guess() {
	document.getElementById('new-game').style.display = 'block';
        let input = document.getElementById('input').value.trim();
        if (!/^[0-9]{4}$/.test(input)) {
            alert('Please enter four numbers!');
            return;
        }
	/*    
	if (input.size !== 4) {
		alert('Please enter four non-repeating numbers!');
		return;
	}
	*/
        let a = 0;
        let b = 0;
        for (let i = 0; i < 4; i++) {
            let digit = input[i];
            if (target[i] === digit) {
                a++;
            } else if (target.includes(digit)) {
                b++;
            }
        }
        let result = '';
        if (a === 4) {
            result = 'Congratulations! You win!';
            document.getElementById('new-game').style.display = 'inline-block';
        } else {
            result = `${a}A${b}B`;
        }
        // Add the guess and the result to the guessHistory array
        guessHistory.push([input, result]);
        // Update the guess history table on the page
        let tbody = document.getElementById('history');
        let tr = document.createElement('tr');
        let td1 = document.createElement('td');
        td1.textContent = input;
        td1.className = 'guess';
        tr.appendChild(td1);
        let td2 = document.createElement('td');
        td2.textContent = result;
        td2.className = 'result';
        tr.appendChild(td2);
        tbody.appendChild(tr);
	
        // Display the guess history table
        if (guessHistory.length === 1) {
            document.getElementById('history').style.display = 'table';
        }
	
        // Display guess count
        let guessCount = guessHistory.length;
        let guessCountMsg = `Guess count: ${guessCount}`;
        if (guessCount > 1) {
            guessCountMsg += ', your guesses:';
            for (let i = 0; i < guessCount; i++) {
                guessCountMsg += ` ${guessHistory[i][0]}(${guessHistory[i][1]})`;
                if (i < guessCount - 1) {
                    guessCountMsg += ',';
                }
            }
        }
        document.getElementById('guess-count').textContent = guessCountMsg;
        
	// Clear the input box
        document.getElementById('input').value = '';
        document.getElementById('input').focus();
    }

    function newGame() {
        // Reset the target number
        target = '';
        while (target.length < 4) {
            let num = Math.floor(Math.random() * 10);
            if (!target.includes(num.toString())) {
                target += num.toString();
            }
        }
        
	// Clear the guess history records
        guessHistory = [];
        let tbody = document.getElementById('history');
        while (tbody.firstChild) {
            tbody.removeChild(tbody.firstChild);
        }
	
        // Hide the "New Game" button
        document.getElementById('new-game').style.display = 'none';
        
	// Clear the guess count message
        document.getElementById('guess-count').textContent = '';
        
	// Display the input box and the "Guess" button
        document.getElementById('input').style.display = 'inline-block';
        document.getElementById('guess-btn').style.display = 'inline-block';
        
	// Hide the guess history table
        document.getElementById('history').style.display = 'none';
        
	// Set focus to the input box
        document.getElementById('input').focus();
    }

    // Listen to the Enter key and call the guess function when pressed
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Enter') {
            guess();
        }
    });
</script>
</body>
</html>
